{
  "name": "HIV Patient Not Tested",
  "description": "HIV patients for whom a viral load has not been done for at least 12 months",
  "repeatInterval": 604800, /* 7 days (in seconds) */
  "conceptMappings": [
    "CIEL_1040", /* HIV RAPID TEST 1, QUALITATIVE */
    "CIEL_703",  /* POSITIVE */
    "CIEL_856"   /* VIRAL LOAD */
  ],
  "sql": "
/*
 * TODO: Limit to HIV positive patients
 * TODO: Avoid repeatedly triggering for same patients
 */
SELECT person_id
FROM
  (
    SELECT
      person_id,
      max(obs_datetime) as latest_viral_load_date
    FROM obs
    WHERE concept_id = CIEL_856
      AND not voided
    GROUP BY person_id
  )
WHERE
  latest_viral_load_date < DATE_SUB(:lastExecutionTime, INTERVAL 12 MONTH);
"
}