{
  "name": "HIV Lost To Follow Up",
  "description": "HIV patients who have not been seen for at least 18 months",
  "interval": "7 days",
  "mappings": [
    "CIEL_1040", /* HIV RAPID TEST 1, QUALITATIVE */
    "CIEL_703"   /* POSITIVE */
  ],
  "sql": "
/*
 * TODO: Limit to HIV positive patients
 * TODO: Refactor to avoid repeatedly triggering for same patients
 */
SELECT person_id
FROM
  person p,
  (
  	SELECT max(encounter_datetime) as latest_encounter
  	FROM encounter e
  	WHERE e.person_id = p.person_id
  	GROUP BY e.person_id
  )
WHERE latest_encounter < DATE_SUB(:lastExecutionTime, INTERVAL 12 MONTH)
  AND not p.voided;
"
}